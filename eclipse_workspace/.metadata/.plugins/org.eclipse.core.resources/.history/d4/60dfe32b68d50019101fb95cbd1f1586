import fr.polymontp.guyon.saimond.entreprise.Commercial;
import fr.polytech.guyon.saimond.download.*;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class Bookmarks_dl {
	
	public static void main(String[] args) {
	    try  {
	        URL url = new URL("www4.ac-nancy-metz.fr/genie-biologique/Docs/Tice/GRF%20TICE/Fiches/6_outils%20bureautique/14_pdf.pdf");
	        HttpURLConnection con = (HttpURLConnection) url.openConnection();
	        String readStream = readStream(con.getInputStream());
	        // Give output for the command line
	        System.out.println(readStream);
	        store(readStream, getName(url.toString()), getExtension(url.toString()));
	    } catch (Exception e) {
	        e.printStackTrace();
	    }
    }

    private static String readStream(InputStream in) {
        StringBuilder sb = new StringBuilder();
        try (BufferedReader reader = new BufferedReader(new InputStreamReader(in));) {
            String nextLine = "";
            while ((nextLine = reader.readLine()) != null) {
                sb.append(nextLine + '\n');
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return sb.toString();
    }
    
    private static void store(String file, String name, String extension) {
    	
    	// Creation du dossier file (si non existant)
    	String directory = System.getProperty("user.dir");
    	directory += "\\file\\";
    	try {
    		new File(directory).mkdir( );
    	} catch (Exception e) {
    		System.out.println(e.getMessage());
    	}
    	
    	// Creation du dossier extension (si non existant)
    	directory += extension;
    	try {
    		new File(directory).mkdir( );
    	} catch (Exception e) {
    		System.out.println(e.getMessage());
    	}
    	
    	directory += "\\";
    	directory += name;
    	directory += ".";
    	directory += extension;
    	
    	try {
    		File outputFile = new File(directory);
    		FileWriter out = new FileWriter(outputFile);
    		out.write(file);
    		out.close();
    	} catch (Exception e) {
    		System.out.println("Error : " + e.getMessage());
    	}
    	
    }
    
    public static String getExtension(String url) {
    	String[] tab = url.split(".");
    	String extension = tab[tab.length-1];
		return extension;
    }
    
    public static String getName(String url) {
    	String[] tab = url.split("\\.");
    	System.out.println(tab.length-2);
    	String extension = tab[tab.length-2];
		return extension;
    }
}
